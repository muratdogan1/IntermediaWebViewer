@model Intermedia.Web.Models.ViewerIndexVm

<div class="ov-shell">
  <div class="ov-card">

    <!-- TOPBAR YOK → Layout kullanıyor -->

    <div class="ov-content">
      <div class="viewer-grid">

        <!-- LEFT -->
        <div class="viewer-left">
          <div class="study-tree">
            @foreach (var st in Model.Studies)
            {
              <div class="study-block">
                <div class="study-title">
                  <div class="study-pn">@st.PatientName</div>
                  <div class="study-uid">@st.StudyInstanceUid</div>
                </div>

                @foreach (var se in st.Series)
                {
                  <div class="series-block">
                    <div class="series-title">
                      <span class="badge">@se.Modality</span>
                      <span class="series-desc">@se.SeriesDescription</span>
                    </div>

                    <div class="gridthumbs">
                      @foreach (var f in se.Files)
                      {
                        var active = f.FileName == Model.Selected ? "active" : "";
                        <a class="thumbLink @active"
                           data-file="@f.FileName">
                          <img src="/Viewer/Render?file=@f.FileName&w=160" />
                        </a>
                      }
                    </div>
                  </div>
                }
              </div>
            }
          </div>
        </div>

        <!-- MAIN -->
        <div class="viewer-main">

          <!-- TOOLBAR -->
          <div class="viewer-toolbar">

            <button class="ov-icbtn" id="zoomIn">+</button>
            <button class="ov-icbtn" id="zoomOut">−</button>
            <button class="ov-icbtn" id="reset">Reset</button>

            <div class="cine">
              <input id="cineSlider" type="range" min="0" max="0" value="0">
              <span id="cineInfo">0 / 0</span>
            </div>

          </div>

          <!-- CANVAS -->
          <div class="viewer-canvas" id="canvas">
            @if (!string.IsNullOrEmpty(Model.Selected))
            {
              <img id="dicomImg"
                   src="/Viewer/Render?file=@Model.Selected" />
            }
            else
            {
              <div>Seçili görüntü yok</div>
            }
          </div>

        </div>

      </div>
    </div>
  </div>
</div>

<script>
const img = document.getElementById('dicomImg');
const thumbs = Array.from(document.querySelectorAll('.thumbLink'));
const slider = document.getElementById('cineSlider');
const info = document.getElementById('cineInfo');

if(img && thumbs.length){

  let idx = thumbs.findIndex(t =>
    t.dataset.file === "@Model.Selected");

  if(idx < 0) idx = 0;

  const files = thumbs.map(t => t.dataset.file);

  slider.max = files.length - 1;
  slider.value = idx;

  function setImage(i){
    if(i < 0) i = 0;
    if(i >= files.length) i = files.length-1;

    idx = i;
    slider.value = i;
    info.textContent = (i+1)+" / "+files.length;

    img.src = "/Viewer/Render?file=" + files[i];

    thumbs.forEach(t=>t.classList.remove("active"));
    thumbs[i].classList.add("active");
  }

  thumbs.forEach((t,i)=>{
    t.onclick = e=>{
      e.preventDefault();
      setImage(i);
    }
  });

  slider.oninput = ()=> setImage(parseInt(slider.value));

  setImage(idx);
}

/* ZOOM */
let scale=1;

document.getElementById("zoomIn").onclick=()=>{
  scale*=1.2;
  img.style.transform="scale("+scale+")";
}

document.getElementById("zoomOut").onclick=()=>{
  scale/=1.2;
  img.style.transform="scale("+scale+")";
}

document.getElementById("reset").onclick=()=>{
  scale=1;
  img.style.transform="scale(1)";
}
</script>